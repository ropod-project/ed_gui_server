!function(){function a(a){this.object=a,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-(1/0),this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25;var b,c,d=this,e=1e-6,f=0,g=0,h=1,i=new THREE.Vector3,j=!1;this.getPolarAngle=function(){return c},this.getAzimuthalAngle=function(){return b},this.rotateLeft=function(a){g-=a},this.rotateUp=function(a){f-=a},this.panLeft=function(){var a=new THREE.Vector3;return function(b){var c=this.object.matrix.elements;a.set(c[0],c[1],c[2]),a.multiplyScalar(-b),i.add(a)}}(),this.panUp=function(){var a=new THREE.Vector3;return function(b){var c=this.object.matrix.elements;a.set(c[4],c[5],c[6]),a.multiplyScalar(b),i.add(a)}}(),this.pan=function(a,b,c,e){if(d.object instanceof THREE.PerspectiveCamera){var f=d.object.position,g=f.clone().sub(d.target),h=g.length();h*=Math.tan(d.object.fov/2*Math.PI/180),d.panLeft(2*a*h/e),d.panUp(2*b*h/e)}else d.object instanceof THREE.OrthographicCamera?(d.panLeft(a*(d.object.right-d.object.left)/c),d.panUp(b*(d.object.top-d.object.bottom)/e)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")},this.dollyIn=function(a){d.object instanceof THREE.PerspectiveCamera?h/=a:d.object instanceof THREE.OrthographicCamera?(d.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*a)),d.object.updateProjectionMatrix(),j=!0):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")},this.dollyOut=function(a){d.object instanceof THREE.PerspectiveCamera?h*=a:d.object instanceof THREE.OrthographicCamera?(d.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/a)),d.object.updateProjectionMatrix(),j=!0):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")},this.update=function(){var d=new THREE.Vector3,k=(new THREE.Quaternion).setFromUnitVectors(a.up,new THREE.Vector3(0,0,1)),l=k.clone().inverse(),m=new THREE.Vector3,n=new THREE.Quaternion;return console.log(a.up),function(){var a=this.object.position;d.copy(a).sub(this.target),d.applyQuaternion(k),b=Math.atan2(d.x,d.y),c=Math.atan2(Math.sqrt(d.x*d.x+d.y*d.y),d.z),b+=g,c+=f,b=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,b)),c=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,c)),c=Math.max(e,Math.min(Math.PI-e,c));var o=d.length()*h;return o=Math.max(this.minDistance,Math.min(this.maxDistance,o)),this.target.add(i),d.x=o*Math.sin(c)*Math.sin(b),d.z=o*Math.cos(c),d.y=o*Math.sin(c)*Math.cos(b),d.applyQuaternion(l),a.copy(this.target).add(d),this.object.lookAt(this.target),this.enableDamping===!0?(g*=1-this.dampingFactor,f*=1-this.dampingFactor):(g=0,f=0),h=1,i.set(0,0,0),j||m.distanceToSquared(this.object.position)>e||8*(1-n.dot(this.object.quaternion))>e?(m.copy(this.object.position),n.copy(this.object.quaternion),j=!1,!0):!1}}()}THREE.OrbitControls=function(b,c){function d(a,b){var c=q.domElement===document?q.domElement.body:q.domElement;p.pan(a,b,c.clientWidth,c.clientHeight)}function e(){return 2*Math.PI/60/60*q.autoRotateSpeed}function f(){return Math.pow(.95,q.zoomSpeed)}function g(a){if(q.enabled!==!1){if(a.preventDefault(),a.button===q.mouseButtons.ORBIT){if(q.enableRotate===!1)return;B=A.ROTATE,r.set(a.clientX,a.clientY)}else if(a.button===q.mouseButtons.ZOOM){if(q.enableZoom===!1)return;B=A.DOLLY,x.set(a.clientX,a.clientY)}else if(a.button===q.mouseButtons.PAN){if(q.enablePan===!1)return;B=A.PAN,u.set(a.clientX,a.clientY)}B!==A.NONE&&(document.addEventListener("mousemove",h,!1),document.addEventListener("mouseup",i,!1),q.dispatchEvent(D))}}function h(a){if(q.enabled!==!1){a.preventDefault();var b=q.domElement===document?q.domElement.body:q.domElement;if(B===A.ROTATE){if(q.enableRotate===!1)return;s.set(a.clientX,a.clientY),t.subVectors(s,r),p.rotateLeft(2*Math.PI*-t.x/b.clientWidth*q.rotateSpeed),p.rotateUp(2*Math.PI*t.y/b.clientHeight*q.rotateSpeed),r.copy(s)}else if(B===A.DOLLY){if(q.enableZoom===!1)return;y.set(a.clientX,a.clientY),z.subVectors(y,x),z.y>0?p.dollyIn(f()):z.y<0&&p.dollyOut(f()),x.copy(y)}else if(B===A.PAN){if(q.enablePan===!1)return;v.set(a.clientX,a.clientY),w.subVectors(v,u),d(w.x,w.y),u.copy(v)}B!==A.NONE&&q.update()}}function i(){q.enabled!==!1&&(document.removeEventListener("mousemove",h,!1),document.removeEventListener("mouseup",i,!1),q.dispatchEvent(E),B=A.NONE)}function j(a){if(q.enabled!==!1&&q.enableZoom!==!1&&B===A.NONE){a.preventDefault(),a.stopPropagation();var b=0;void 0!==a.wheelDelta?b=a.wheelDelta:void 0!==a.detail&&(b=-a.detail),b>0?p.dollyOut(f()):0>b&&p.dollyIn(f()),q.update(),q.dispatchEvent(D),q.dispatchEvent(E)}}function k(a){if(q.enabled!==!1&&q.enableKeys!==!1&&q.enablePan!==!1)switch(a.keyCode){case q.keys.UP:d(0,q.keyPanSpeed),q.update();break;case q.keys.BOTTOM:d(0,-q.keyPanSpeed),q.update();break;case q.keys.LEFT:d(q.keyPanSpeed,0),q.update();break;case q.keys.RIGHT:d(-q.keyPanSpeed,0),q.update()}}function l(a){if(q.enabled!==!1){switch(a.touches.length){case 1:if(q.enableRotate===!1)return;B=A.TOUCH_ROTATE,r.set(a.touches[0].pageX,a.touches[0].pageY);break;case 2:if(q.enableZoom===!1)return;B=A.TOUCH_DOLLY;var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY,d=Math.sqrt(b*b+c*c);x.set(0,d);break;case 3:if(q.enablePan===!1)return;B=A.TOUCH_PAN,u.set(a.touches[0].pageX,a.touches[0].pageY);break;default:B=A.NONE}B!==A.NONE&&q.dispatchEvent(D)}}function m(a){if(q.enabled!==!1){a.preventDefault(),a.stopPropagation();var b=q.domElement===document?q.domElement.body:q.domElement;switch(a.touches.length){case 1:if(q.enableRotate===!1)return;if(B!==A.TOUCH_ROTATE)return;s.set(a.touches[0].pageX,a.touches[0].pageY),t.subVectors(s,r),p.rotateLeft(2*Math.PI*t.x/b.clientWidth*q.rotateSpeed),p.rotateUp(2*Math.PI*t.y/b.clientHeight*q.rotateSpeed),r.copy(s),q.update();break;case 2:if(q.enableZoom===!1)return;if(B!==A.TOUCH_DOLLY)return;var c=a.touches[0].pageX-a.touches[1].pageX,e=a.touches[0].pageY-a.touches[1].pageY,g=Math.sqrt(c*c+e*e);y.set(0,g),z.subVectors(y,x),z.y>0?p.dollyOut(f()):z.y<0&&p.dollyIn(f()),x.copy(y),q.update();break;case 3:if(q.enablePan===!1)return;if(B!==A.TOUCH_PAN)return;v.set(a.touches[0].pageX,a.touches[0].pageY),w.subVectors(v,u),d(w.x,w.y),u.copy(v),q.update();break;default:B=A.NONE}}}function n(){q.enabled!==!1&&(q.dispatchEvent(E),B=A.NONE)}function o(a){a.preventDefault()}var p=new a(b);this.domElement=void 0!==c?c:document,Object.defineProperty(this,"constraint",{get:function(){return p}}),this.getPolarAngle=function(){return p.getPolarAngle()},this.getAzimuthalAngle=function(){return p.getAzimuthalAngle()},this.enabled=!0,this.center=this.target,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT};var q=this,r=new THREE.Vector2,s=new THREE.Vector2,t=new THREE.Vector2,u=new THREE.Vector2,v=new THREE.Vector2,w=new THREE.Vector2,x=new THREE.Vector2,y=new THREE.Vector2,z=new THREE.Vector2,A={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},B=A.NONE;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom;var C={type:"change"},D={type:"start"},E={type:"end"};this.update=function(){this.autoRotate&&B===A.NONE&&p.rotateLeft(e()),p.update()===!0&&this.dispatchEvent(C)},this.reset=function(){B=A.NONE,this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(C),this.update()},this.dispose=function(){this.domElement.removeEventListener("contextmenu",o,!1),this.domElement.removeEventListener("mousedown",g,!1),this.domElement.removeEventListener("mousewheel",j,!1),this.domElement.removeEventListener("DOMMouseScroll",j,!1),this.domElement.removeEventListener("touchstart",l,!1),this.domElement.removeEventListener("touchend",n,!1),this.domElement.removeEventListener("touchmove",m,!1),document.removeEventListener("mousemove",h,!1),document.removeEventListener("mouseup",i,!1),window.removeEventListener("keydown",k,!1)},this.domElement.addEventListener("contextmenu",o,!1),this.domElement.addEventListener("mousedown",g,!1),this.domElement.addEventListener("mousewheel",j,!1),this.domElement.addEventListener("DOMMouseScroll",j,!1),this.domElement.addEventListener("touchstart",l,!1),this.domElement.addEventListener("touchend",n,!1),this.domElement.addEventListener("touchmove",m,!1),window.addEventListener("keydown",k,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{object:{get:function(){return this.constraint.object}},target:{get:function(){return this.constraint.target},set:function(a){console.warn("THREE.OrbitControls: target is now immutable. Use target.set() instead."),this.constraint.target.copy(a)}},minDistance:{get:function(){return this.constraint.minDistance},set:function(a){this.constraint.minDistance=a}},maxDistance:{get:function(){return this.constraint.maxDistance},set:function(a){this.constraint.maxDistance=a}},minZoom:{get:function(){return this.constraint.minZoom},set:function(a){this.constraint.minZoom=a}},maxZoom:{get:function(){return this.constraint.maxZoom},set:function(a){this.constraint.maxZoom=a}},minPolarAngle:{get:function(){return this.constraint.minPolarAngle},set:function(a){this.constraint.minPolarAngle=a}},maxPolarAngle:{get:function(){return this.constraint.maxPolarAngle},set:function(a){this.constraint.maxPolarAngle=a}},minAzimuthAngle:{get:function(){return this.constraint.minAzimuthAngle},set:function(a){this.constraint.minAzimuthAngle=a}},maxAzimuthAngle:{get:function(){return this.constraint.maxAzimuthAngle},set:function(a){this.constraint.maxAzimuthAngle=a}},enableDamping:{get:function(){return this.constraint.enableDamping},set:function(a){this.constraint.enableDamping=a}},dampingFactor:{get:function(){return this.constraint.dampingFactor},set:function(a){this.constraint.dampingFactor=a}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(a){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!a}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(a){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!a}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(a){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!a}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(a){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!a}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.constraint.enableDamping},set:function(a){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.constraint.enableDamping=!a}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.constraint.dampingFactor},set:function(a){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.constraint.dampingFactor=a}}})}();var ros,entities=[],cameraControls,COLORS=[10066329,10066278,10066227,10053273,10053222,10053171,10040217,10040166,10040115,6723993,6723942,6723891,6710937,6710886,6710835,6697881,6697830,6697779,3381657,3381606,3381555,3368601,3368550,3368499,3355545,3355494,3355443],stringToColor=function(a){for(var b=0,c=5381;b<a.length;c=(c<<5)+c+a.charCodeAt(b++));return 0>c&&(c=-c),b=c%COLORS.length,COLORS[b]},ros_host="localhost",rosUrl="ws://"+ros_host+":9090";ros=new ROSLIB.Ros({url:rosUrl});var clientED=new ROSLIB.Service({ros:ros,name:"ed/query",serviceType:"ed/Query"}),scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),clock=new THREE.Clock,renderer=new THREE.WebGLRenderer;renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(renderer.domElement),scene.add(new THREE.AmbientLight(4210752));var light=new THREE.DirectionalLight(16777215);light.position.set(3,12,8),scene.add(light),camera.position.x=0,camera.position.y=-3,camera.position.z=3,camera.up=new THREE.Vector3(0,0,1),cameraControls=new THREE.OrbitControls(camera,renderer.domElement),cameraControls.enableDamping=!0,cameraControls.dampingFactor=.25,cameraControls.enableZoom=!0,cameraControls.rotateSpeed=.1;var render=function(){var a=clock.getDelta();requestAnimationFrame(render),cameraControls.update(a),renderer.render(scene,camera)},req=new ROSLIB.ServiceRequest({});clientED.callService(req,function(a){console.time("JSON.parse");var b=JSON.parse(a.human_readable);console.timeEnd("JSON.parse"),console.time("generate meshes");for(var c=0;c<b.entities.length;c++){var d=b.entities[c],e=entities[d.idx];if(!e){if(!("mesh"in d&&"pose"in d))continue;var f=new THREE.MeshPhongMaterial({shading:THREE.SmoothShading});f.color.setHex(stringToColor(d.id));var g=new THREE.BoxGeometry(.1,.1,.1);e=new THREE.Mesh(g,f),scene.add(e),entities[d.idx]=e}if("mesh"in d){for(var g=new THREE.Geometry,h=0;h<d.mesh.vertices.length;h++){var i=d.mesh.vertices[h];g.vertices.push(new THREE.Vector3(i.x,i.y,i.z))}for(var h=0;h<d.mesh.triangles.length;h++){var j=d.mesh.triangles[h];g.faces.push(new THREE.Face3(j.i1,j.i2,j.i3))}g.computeFaceNormals(),e.geometry=g}"pose"in d&&(e.position.set(d.pose.x,d.pose.y,d.pose.z),e.quaternion.set(d.pose.qx,d.pose.qy,d.pose.qz,d.pose.qw))}console.timeEnd("generate meshes"),render()});